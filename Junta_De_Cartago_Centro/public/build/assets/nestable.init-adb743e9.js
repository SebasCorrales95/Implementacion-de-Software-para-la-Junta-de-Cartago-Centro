(function(n,f,h,m){function g(t,e){this.w=n(h),this.el=n(t),(e=e||E).rootClass!==m&&e.rootClass!=="dd"&&(e.listClass=e.listClass?e.listClass:e.rootClass+"-list",e.itemClass=e.itemClass?e.itemClass:e.rootClass+"-item",e.dragClass=e.dragClass?e.dragClass:e.rootClass+"-dragel",e.handleClass=e.handleClass?e.handleClass:e.rootClass+"-handle",e.collapsedClass=e.collapsedClass?e.collapsedClass:e.rootClass+"-collapsed",e.placeClass=e.placeClass?e.placeClass:e.rootClass+"-placeholder",e.noDragClass=e.noDragClass?e.noDragClass:e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass?e.noChildrenClass:e.rootClass+"-nochildren",e.emptyClass=e.emptyClass?e.emptyClass:e.rootClass+"-empty"),this.options=n.extend({},E,e),this.options.json!==m&&this._build(),this.init()}var v="ontouchstart"in h,C=function(){var t=h.createElement("div"),e=h.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var l=f.getComputedStyle&&f.getComputedStyle(t,"").pointerEvents==="auto";return e.removeChild(t),!!l}(),E={contentCallback:function(t){return t.content?t.content:t.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,l){},onDragStart:function(t,e,l){},beforeDragStop:function(t,e,l){},listRenderer:function(t,e){var l="<"+e.listNodeName+' class="'+e.listClass+'">';return l+=t,l+="</"+e.listNodeName+">"},itemRenderer:function(t,e,l,a,i){var s=n.map(t,function(r,d){return" "+d+'="'+r+'"'}).join(" "),o="<"+a.itemNodeName+s+">";return o+="<"+a.handleNodeName+' class="'+a.handleClass+'">',o+="<"+a.contentNodeName+' class="'+a.contentClass+'">',o+=e,o+="</"+a.contentNodeName+">",o+="</"+a.handleNodeName+">",o+=l,o+="</"+a.itemNodeName+">"}};g.prototype={init:function(){var t=this;t.reset(),t.el.data("nestable-group",this.options.group),t.placeEl=n('<div class="'+t.options.placeClass+'"/>');var e=this.el.find(t.options.itemNodeName);n.each(e,function(s,o){var r=n(o),d=r.parent();t.setParent(r),d.hasClass(t.options.collapsedClass)&&t.collapseItem(d.parent())}),e.length||this.appendEmptyElement(this.el),t.el.on("click","button",function(s){if(!t.dragEl){var o=n(s.currentTarget),r=o.data("action"),d=o.parents(t.options.itemNodeName).eq(0);r==="collapse"&&t.collapseItem(d),r==="expand"&&t.expandItem(d)}});var l=function(s){var o=n(s.target);if(!o.hasClass(t.options.handleClass)){if(o.closest("."+t.options.noDragClass).length)return;o=o.closest("."+t.options.handleClass)}o.length&&!t.dragEl&&(t.isTouch=/^touch/.test(s.type),t.isTouch&&s.touches.length!==1||(s.preventDefault(),t.dragStart(s.touches?s.touches[0]:s)))},a=function(s){t.dragEl&&(s.preventDefault(),t.dragMove(s.touches?s.touches[0]:s))},i=function(s){t.dragEl&&(s.preventDefault(),t.dragStop(s.touches?s.changedTouches[0]:s))};v&&(t.el[0].addEventListener("touchstart",l,!1),f.addEventListener("touchmove",a,!1),f.addEventListener("touchend",i,!1),f.addEventListener("touchcancel",i,!1)),t.el.on("mousedown",l),t.w.on("mousemove",a),t.w.on("mouseup",i),t.el.bind("destroy-nestable",function(){v&&(t.el[0].removeEventListener("touchstart",l,!1),f.removeEventListener("touchmove",a,!1),f.removeEventListener("touchend",i,!1),f.removeEventListener("touchcancel",i,!1)),t.el.off("mousedown",l),t.w.off("mousemove",a),t.w.off("mouseup",i),t.el.off("click"),t.el.unbind("destroy-nestable"),t.el.data("nestable",null)})},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,l=n(this.el).children(e);t.parent_id!==m&&(l=l.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,l.children(e).length===0&&(l=l.append(this.options.listRenderer("",this.options))),l=l.find(e+":first"),this.setParent(l.parent())),l.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,l=this.el;(t=t||this).remove();var a="."+e.listClass+" ."+e.listClass+":not(:has(*))";n(l).find(a).remove(),n(l).find('[data-action="expand"], [data-action="collapse"]').each(function(){n(this).siblings("."+e.listClass).length===0&&n(this).remove()})},remove:function(t,e){var l=this.options,a=this,i=this._getItemById(t),s=l.effect.animation||"fade",o=l.effect.time||"slow";s==="fade"?i.fadeOut(o,function(){a.removeItem(i)}):this.removeItem(i),e&&e()},removeAll:function(t){function e(){s.each(function(){l.removeItem(n(this))}),i.show(),t&&t()}var l=this,a=this.options,i=l.el.find(a.listNodeName).first(),s=i.children(a.itemNodeName),o=a.effect.animation||"fade",r=a.effect.time||"slow";o==="fade"?i.fadeOut(r,e):e()},_getItemById:function(t){return n(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;typeof t=="string"&&(t=JSON.parse(t)),n(this.el).html(this._buildList(t,this.options))},_buildList:function(t,e){if(!t)return"";var l="",a=this;return n.each(t,function(i,s){l+=a._buildItem(s,e)}),e.listRenderer(l,e)},_buildItem:function(t,e){function l(d){var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return d+"".replace(/[&<>"']/g,function(p){return c[p]})}function a(d){var c={};for(var p in d)c[d[p]]=d[p];return c}var i=function(d){delete(d=n.extend({},d)).children,delete d.classes,delete d.content;var c={};return n.each(d,function(p,u){typeof u=="object"&&(u=JSON.stringify(u)),c["data-"+p]=l(u)}),c}(t);i.class=function(d,c){var p=d.classes||{};typeof p=="string"&&(p=[p]);var u=a(p);return u[c.itemClass]=c.itemClass,n.map(u,function(N){return N}).join(" ")}(t,e);var s=e.contentCallback(t),o=this._buildList(t.children,e),r=n(e.itemRenderer(i,s,o,e,t));return this.setParent(r),r[0].outerHTML},serialize:function(){var t=this,e=function(l){var a=[];return l.children(t.options.itemNodeName).each(function(){var i=n(this),s=n.extend({},i.data()),o=i.children(t.options.listNodeName);if(t.options.includeContent){var r=i.find("."+t.options.contentClass).html();r&&(s.content=r)}o.length&&(s.children=e(o)),a.push(s)}),a};return e(t.el.find(t.options.listNodeName).first())},asNestedSet:function(){function t(o,r,d){var c,p,u=d+1;return n(o).children(a.listNodeName).children(a.itemNodeName).length>0&&(r++,n(o).children(a.listNodeName).children(a.itemNodeName).each(function(){u=t(n(this),r,u)}),r--),c=n(o).attr("data-id"),e(c)&&(c=parseInt(c)),p=n(o).parent(a.listNodeName).parent(a.itemNodeName).attr("data-id")||"",e(p)&&(c=parseInt(p)),c&&i.push({id:c,parent_id:p,depth:r,lft:d,rgt:u}),d=u+1}function e(o){return n.isNumeric(o)&&Math.floor(o)==o}var l=this,a=l.options,i=[],s=1;return l.el.find(a.listNodeName).first().children(a.itemNodeName).each(function(){s=t(this,0,s)}),i=i.sort(function(o,r){return o.lft-r.lft})},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){function e(i){var s=(n(i).attr(l.attribute||"id")||"").match(l.expression||/(.+)[-=_](.+)/);if(s){var o={id:s[2]};return n(i).children(l.listType).children(l.items).length>0&&(o.children=[],n(i).children(l.listType).children(l.items).each(function(){var r=e(this);o.children.push(r)})),o}}var l=n.extend({},this.options,t),a=[];return n(this.element).children(l.items).each(function(){var i=e(this);a.push(i)}),a},toArray:function(){function t(o,r,d){var c,p,u=d+1;return o.children(e.options.listNodeName).children(e.options.itemNodeName).length>0&&(r++,o.children(e.options.listNodeName).children(e.options.itemNodeName).each(function(){u=t(n(this),r,u)}),r--),c=o.data().id,p=r===l+1?e.rootID:o.parent(e.options.listNodeName).parent(e.options.itemNodeName).data().id,c&&a.push({id:c,parent_id:p,depth:r,left:d,right:u}),d=u+1}var e=n.extend({},this.options,this),l=e.startDepthCount||0,a=[],i=2,s=this;return s.el.find(s.options.listNodeName).first().children(s.options.itemNodeName).each(function(){i=t(n(this),l+1,i)}),a=a.sort(function(o,r){return o.left-r.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(n(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(n(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(n(this.options.expandBtnHTML)),t.prepend(n(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,l=n(t.target).closest(this.options.itemNodeName),a={top:t.pageY,left:t.pageX},i=this.options.onDragStart.call(this,this.el,l,a);if(i===void 0||i!==!1){this.placeEl.css("height",l.height()),e.offsetX=t.pageX-l.offset().left,e.offsetY=t.pageY-l.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=n(h.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",l.outerWidth()),this.setIndexOfItem(l),l.after(this.placeEl),l[0].parentNode.removeChild(l[0]),l.appendTo(this.dragEl),n(h.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});var s,o,r=this.dragEl.find(this.options.itemNodeName);for(s=0;s<r.length;s++)(o=n(r[s]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=o)}},createSubLevel:function(t,e){var l=n("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&l.append(e),t.append(l),this.setParent(t),l},setIndexOfItem:function(t,e){(e=e||[]).unshift(t.index()),n(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(n(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){for(var l=this.el,a=e.length-1,i=0;i<e.length;i++){if(a===parseInt(i))return void function(r,d){e[a]===0?n(r).prepend(d.clone(!0)):n(r.children[e[a]-1]).after(d.clone(!0))}(l,t);var s=l[0]?l[0]:l,o=s.children[e[i]];l=o||this.createSubLevel(n(s))}},dragStop:function(t){var e={top:t.pageY,left:t.pageX},l=this.dragEl.data("indexOfItem"),a=this.dragEl.children(this.options.itemNodeName).first();a[0].parentNode.removeChild(a[0]),this.dragEl.remove();var i=this.options.beforeDragStop.call(this,this.el,a,this.placeEl.parent());if(i!==void 0&&i===!1){var s=this.placeEl.parent();return this.placeEl.remove(),s.children().length||this.unsetParent(s.parent()),this.restoreItemAtIndex(a,l),void this.reset()}this.placeEl.replaceWith(a),this.hasNewRoot?(this.options.fixed===!0?this.restoreItemAtIndex(a,l):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,a,e),this.reset()},dragMove:function(t){var e,l,a,i=this.options,s=this.mouse;this.dragEl.css({left:t.pageX-s.offsetX,top:t.pageY-s.offsetY}),s.lastX=s.nowX,s.lastY=s.nowY,s.nowX=t.pageX,s.nowY=t.pageY,s.distX=s.nowX-s.lastX,s.distY=s.nowY-s.lastY,s.lastDirX=s.dirX,s.lastDirY=s.dirY,s.dirX=s.distX===0?0:s.distX>0?1:-1,s.dirY=s.distY===0?0:s.distY>0?1:-1;var o=Math.abs(s.distX)>Math.abs(s.distY)?1:0;if(!s.moving)return s.dirAx=o,void(s.moving=!0);if(i.scroll)if(f.jQuery.fn.scrollParent!==void 0){var r=!1,d=this.el.scrollParent()[0];d!==h&&d.tagName!=="HTML"?(i.scrollTriggers.bottom+d.offsetHeight-t.pageY<i.scrollSensitivity?d.scrollTop=r=d.scrollTop+i.scrollSpeed:t.pageY-i.scrollTriggers.top<i.scrollSensitivity&&(d.scrollTop=r=d.scrollTop-i.scrollSpeed),i.scrollTriggers.right+d.offsetWidth-t.pageX<i.scrollSensitivity?d.scrollLeft=r=d.scrollLeft+i.scrollSpeed:t.pageX-i.scrollTriggers.left<i.scrollSensitivity&&(d.scrollLeft=r=d.scrollLeft-i.scrollSpeed)):(t.pageY-n(h).scrollTop()<i.scrollSensitivity?r=n(h).scrollTop(n(h).scrollTop()-i.scrollSpeed):n(f).height()-(t.pageY-n(h).scrollTop())<i.scrollSensitivity&&(r=n(h).scrollTop(n(h).scrollTop()+i.scrollSpeed)),t.pageX-n(h).scrollLeft()<i.scrollSensitivity?r=n(h).scrollLeft(n(h).scrollLeft()-i.scrollSpeed):n(f).width()-(t.pageX-n(h).scrollLeft())<i.scrollSensitivity&&(r=n(h).scrollLeft(n(h).scrollLeft()+i.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),i.scroll&&r&&(this.scrollTimer=setTimeout(function(){n(f).trigger(t)},10)),s.dirAx!==o?(s.distAxX=0,s.distAxY=0):(s.distAxX+=Math.abs(s.distX),s.dirX!==0&&s.dirX!==s.lastDirX&&(s.distAxX=0),s.distAxY+=Math.abs(s.distY),s.dirY!==0&&s.dirY!==s.lastDirY&&(s.distAxY=0)),s.dirAx=o,s.dirAx&&s.distAxX>=i.threshold&&(s.distAxX=0,a=this.placeEl.prev(i.itemNodeName),s.distX>0&&a.length&&!a.hasClass(i.collapsedClass)&&!a.hasClass(i.noChildrenClass)&&(e=a.find(i.listNodeName).last(),this.placeEl.parents(i.listNodeName).length+this.dragDepth<=i.maxDepth&&(e.length?(e=a.children(i.listNodeName).last()).append(this.placeEl):this.createSubLevel(a,this.placeEl))),s.distX<0&&(this.placeEl.next(i.itemNodeName).length||(l=this.placeEl.parent(),this.placeEl.closest(i.itemNodeName).after(this.placeEl),l.children().length||this.unsetParent(l.parent()))));var c=!1;if(C||(this.dragEl[0].style.visibility="hidden"),this.pointEl=n(h.elementFromPoint(t.pageX-h.body.scrollLeft,t.pageY-(f.pageYOffset||h.documentElement.scrollTop))),C||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(i.handleClass)&&(this.pointEl=this.pointEl.closest(i.itemNodeName)),this.pointEl.hasClass(i.emptyClass))c=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(i.itemClass))return;var p=this.pointEl.closest("."+i.rootClass),u=this.dragRootEl.data("nestable-id")!==p.data("nestable-id");if(!s.dirAx||u||c){if(u&&i.group!==p.data("nestable-group")||this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(i.listNodeName).length||this.dragDepth-1+this.pointEl.parents(i.listNodeName).length>i.maxDepth)return;var N=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;l=this.placeEl.parent(),c?((e=n(h.createElement(i.listNodeName)).addClass(i.listClass)).append(this.placeEl),this.pointEl.replaceWith(e)):N?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),l.children().length||this.unsetParent(l.parent()),this.dragRootEl.find(i.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=p,u&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},n.fn.nestable=function(t){var e=this,l=this,a=arguments;return"Nestable"in f||(f.Nestable={},Nestable.counter=0),e.each(function(){var i=n(this).data("nestable");if(i){if(typeof t=="string"&&typeof i[t]=="function")if(a.length>1){for(var s=[],o=1;o<a.length;o++)s.push(a[o]);l=i[t].apply(i,s)}else l=i[t]()}else Nestable.counter++,n(this).data("nestable",new g(this,t)),n(this).data("nestable-id",Nestable.counter)}),l||e}})(window.jQuery||window.Zepto,window,document);(function(n){var f=function(){};f.prototype.updateOutput=function(h){var m=h.length?h:n(h.target),g=m.data("output");window.JSON?g.val(window.JSON.stringify(m.nestable("serialize"))):g.val("JSON browser support required for this demo.")},f.prototype.init=function(){n("#nestable_list_1").nestable({group:1}).on("change",this.updateOutput),n("#nestable_list_2").nestable({group:1}).on("change",this.updateOutput),this.updateOutput(n("#nestable_list_1").data("output",n("#nestable_list_1_output"))),this.updateOutput(n("#nestable_list_2").data("output",n("#nestable_list_2_output"))),n("#nestable_list_menu").on("click",function(h){var m=n(h.target),g=m.data("action");g==="expand-all"&&n(".dd").nestable("expandAll"),g==="collapse-all"&&n(".dd").nestable("collapseAll")}),n("#nestable_list_3").nestable()},n.Nestable=new f,n.Nestable.Constructor=f})(window.jQuery),function(n){n.Nestable.init()}(window.jQuery);
